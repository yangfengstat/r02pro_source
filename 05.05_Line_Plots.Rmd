## Line Plots {#line-plot}

In this section, we will introduce the **line plot**, which is very useful for visualizing trends and often used in time series. 

Let's work on the `sahp` dataset, where we would like to study the trend of the sale price as a function of the sold date of the house.

### Line Plots via `plot()`

To generate a line plot, you can use the `plot()` function by setting the argument `type = "l"`. 

```{r}
library(r02pro)
plot(sahp$dt_sold, 
     sahp$sale_price, 
     type = "l")
```

Wow, this doesn't look pretty at all. The reason that we get such a chaotic plot is due to the working mechanism of `plot()`. The `plot()` works by first getting the location of the value pairs of `dt_sold` and `sale_price`. Then, connect the points **in the order of the observations**. 

As a result, before calling the `plot()` function, you need to first sort the observations (in Section \@ref(numeric-sort-rank-order)) according to the variable on the x-axis, which is `dt_sold` in this example. 

```{r}
dt_sold_order <- order(sahp$dt_sold)
plot(sahp$dt_sold[dt_sold_order], 
     sahp$sale_price[dt_sold_order], 
     type = "l", 
     xlab = "Date Sold", 
     ylab = "Sale Price")
```

Note that here we added the labels for the x and y axes like we did for scatterplots.
 
In the line plots, we would like to introduce two additional graphical parameters that we can customize in the `plot()` function.

```{r echo = FALSE, results = TRUE}
Parameter  <- c('`lty`',"`lwd`")
Meaning <- c("The line type", "The line width")
Example <- c('"dashed"', '2')
d <- data.frame(Parameter, Meaning, Example)
knitr::kable(d)
```

The line type can be either a integer from 0 to 6 or the corresponding character string, which is summarize in the following figure.

```{r all-line-types, echo=FALSE, fig.align = 'center', fig.cap="All Possible Line Types"}
library(ggplot2)
linetypes <- data.frame(
  linetype = factor(
    0:6,
    labels = c("blank", "solid", "dashed", "dotted", "dotdash", "longdash",  "twodash")
  ),
  name = c("blank", "solid", "dashed", "dotted", "dotdash", "longdash",  "twodash"),
  x = rep(1:10, rep(7,10)),
  y = rep(0:6, 10)
)
ggplot(linetypes, aes(x, y)) +
  geom_line(aes(linetype = linetype), size = 1) +
  geom_text(aes(x = 12, label = y), hjust = 0) + geom_text(aes(x = 10.5, label = linetype), hjust = 0) +
  scale_linetype_identity() +
  theme_void()
```


<!-- ```{r echo = FALSE, results = TRUE} -->
<!-- Intgers  <- c('`lty = 0`','`lty = 1`','`lty = 2`','`lty = 3`','`lty = 4`','`lty = 5`','`lty = 6`') -->
<!-- Strings <- c('"blank"', '"solid"', '"dashed"', '"dotted"', '"dotdash"', '"longdash"',  '"twodash"') -->
<!-- d <- data.frame(Intgers, Strings) -->
<!-- knitr::kable(d) -->
<!-- ``` -->

Let's see an example with the two parameters. 

```{r}
plot(sahp$dt_sold[dt_sold_order], 
     sahp$sale_price[dt_sold_order], 
     type = "l", 
     xlab = "Date Sold", 
     ylab = "Sale Price", 
     lty = 2, 
     lwd = 2)
```


The `plot()` function also offers the capability to show the points and line on the same plot by changing `type = "b"`.

```{r, results = TRUE}
plot(sahp$dt_sold[dt_sold_order],
     sahp$sale_price[dt_sold_order], 
     type = "b", 
     xlab = "Date Sold", 
     ylab = "Sale Price")
```



### Line Plots via `geom_line()`

In addition to the `plot()` function in base R, we can use the `geom_line()` function in the ggplot family. 

```{r, warning = FALSE, message=FALSE}
library(tidyverse)
ggplot(data = sahp) + 
  geom_line(mapping = aes(x = dt_sold, 
                          y = sale_price))
```

The generated line plot looks essentially the same as that generated by `plot()`. It is worth noting that here, the points are connected **not** by the order of the observations, but **by the values of the variable on the x-axis**, i.e. `dt_sold`, which avoids the need to sort the observations by the x-axis. 

### Constant-Valued Aesthetics in Line Plots

Like in Scatterplots, you can also set Constant-Valued Aesthetics (see Section \@ref(aes-constant-value)) in line plots. 

***a. Color***

We can change the color of the line by setting the color aesthetic to a constant value.

```{r}
ggplot(data = sahp) + 
  geom_line(mapping = aes(x = dt_sold,
                          y = sale_price), 
            color = "red")
```

***b. Line Type***

One useful aesthetic in `geom_line()` that was not applicable in `geom_point()` is `linetype`, which controls the line type. The collection of different line types is available in Figure \@ref(fig:all-line-types).

```{r}
ggplot(data = sahp) + 
  geom_line(mapping = aes(x = dt_sold,
                          y = sale_price), 
            linetype = "dashed")
```

***c. Size***

Similar to scatterplots, you can also set the `size` aesthetic in a line plot. While the `size` controls the size of the points in a scatterplot, the `size` aesthetic controls the **width** of the line.

```{r}
ggplot(data = sahp) + 
  geom_line(mapping = aes(x = dt_sold,
                          y = sale_price), 
            size = 2)
```

### Mapping Variables to Aesthetics in Line Plots

In addition to constant-valued aesthetics, you can also Map Variables to Aesthetics (see Section \@ref(aes-local-map)) in line plots to highlight different groups. 


***a. Color***

```{r}
ggplot(data = sahp) + 
  geom_line(mapping = aes(x = dt_sold, 
                          y = sale_price, 
                          color = kit_qual))
```


Here, the observations are divided into groups according to the value of `kit_qual` and separate line plots are generated for each group, represented by different colors. 

***b. Line Type***


Similarly, we can also map variables to the `linetype` aesthetic, which uses different line types for each group. 

```{r}
ggplot(data = sahp) + 
  geom_line(mapping = aes(x = dt_sold, 
                          y = sale_price, 
                          linetype = kit_qual))
```


### Exercises

First, create a data set `sahp_2006` by running the following code
```{r, eval=FALSE}
sahp_2006 <- sahp[format(sahp$dt_sold, "%Y") < 2007, ] #all houses sold before 2007
```
Then, use `sahp_2006` to answer the following questions. 

1. Using `plot()` to create a line plot of `dt_sold` (on the x-axis) and `sale_price` (on the y-axis) to show the trend of the sale price as a function of the sold date of the house, then give title "DS" for the x-axis and title "SP" for the y-axis and make the line to be a "twodash" line. 

2. Using the **ggplot2** package to create a line plot of `dt_sold` (on the x-axis) and `sale_price` (on the y-axis) with different linetypes depending on the value of `house_style`.
